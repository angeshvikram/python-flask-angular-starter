version: "3"
services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile-dev
    container_name: "frontend"
    volumes:
      - ./frontend/src:/app/src # for watching files
    ports:
      - "4200:4200"
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: "backend"
    volumes:
        - ./backend:/app # for watching files
    ports:
      - "5000:5000"
    depends_on:
      - postgres
    environment:
      - APP_SETTINGS=development
      - DATABASE_URL=postgresql://pgadmin:admin@postgres:5432/pgadmin
  postgres:
    image: postgres:9.6
    volumes:
      - ./docker/database:/docker-entrypoint-initdb.d
    ports:
      - "5433:5432"
    environment:
      # default db
      - POSTGRES_USER=pgadmin
      - POSTGRES_PASSWORD=admin
      # airflow db
      - DB_USER=airflow
      - DB_PASSWORD=airflow
      - DB_NAME=airflow
  webserver:
    image: puckel/docker-airflow:1.8.2
    restart: always
    depends_on:
      - postgres
    environment:
      - LOAD_EX=n
      - EXECUTOR=Local
      # AIRFLOW ENVIRONMENT VARIABLES
      - AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql+psycopg2://airflow:airflow@postgres/airflow
    volumes:
      - ./airflow/dags:/usr/local/airflow/dags
      - ./airflow/requirements.txt:/requirements.txt
    ports:
      - "8080:8080"
    command: webserver

